<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDR Consultoria - Eventos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="../../assets/css/eventosCSS/cadastroUsuarios.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="../../assets/js/globaisjs/navbarplusfooterimplementador.js"></script>
    <script src="../../assets/js/eventosjs/cadastrousuarioevento.js"></script>
    <script src="../../assets/js/eventosjs/CRUDcadastrousuarioevento.js"></script>
</head>
    
<body class="orangebg">


    <div id="navbarimplementador">
        
        <!--JS implementa-->

    </div>
        
    <div id ="main">

        <!--JS implementa-->

    </div>

    <div id="CRUD" onload="init()">

        <h1>Cadastro de Cadastro (CRUD)</h1>

        <div class="container">
            <div class="row">
                <div id="msg" class="col-sm-10 offset-sm-1 ">
                </div>
            </div>

            <form id="form-cadastro">
                <div class="form-group row">
                    <div class="col-sm-4">
                        <label for="inputId">ID</label>
                        <input type="text" class="form-control" id="inputId" placeholder="ID" disabled>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-6">
                        <label for="inputIdEvento">ID_Evento</label>
                        <input type="text" class="form-control" id="inputIdEvento" placeholder="ID do evento" disabled >
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-6">
                        <label for="inputUsuario">ID_Usuarios</label>
                        <input type="text" class="form-control" id="inputUsuario" placeholder="Informe id dos usuarios" >
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-4">
                        <small>(*) Campos obrigatórios</small>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-12">
                        <input type="button" class="btn btn-success" id="btnInsert" value="Inserir">
                        <input type="button" class="btn btn-warning" id="btnUpdate" value="Alterar">
                        <input type="button" class="btn btn-danger" id="btnDelete" value="Excluir">
                        <input type="button" class="btn btn-secondary" id="btnClear" value="Limpar Form">
                    </div>
                </div>
            </form>

            <div class="row">
                <div class="col-sm-12">
                    <table id="grid-cadastro" class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">ID_Usuarios</th>
                            </tr>
                        </thead>
                        <tbody id="table-cadastro">
                            <tr>
                                <td scope="row">1</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <div id="footerimplementador">

        <!--JS implementa-->

    </div>

    <script src="../../assets/js/eventosjs/CRUDcadastrousuarioevento.js"></script>
    <script>
        function exibeCadastro() {
            tableCadastro = document.getElementById("table-cadastro");
            tableCadastro.innerHTML = "";

            readCadastro(dados => {
                for (i = 0; i < dados.length; i++) {
                    let cadastro = dados[i];    
                    tableCadastro.innerHTML += `<tr><td scope="row">${cadastro.idEvento}</td>
                                                    <td>${cadastro.idUsuario}</td>
                                                </tr>`;
                }
            })
        }

function init() {
    formCadastro = document.getElementById("form-cadastro");

    // Preenche automaticamente o ID do evento da URL
    const urlParams = new URLSearchParams(window.location.search);
    const eventoId = urlParams.get('id');
    if (eventoId) {
        document.getElementById('inputIdEvento').value = eventoId;
    }

    btnInsert = document.getElementById("btnInsert");
    btnInsert.addEventListener('click', function () {
        if (!formCadastro.checkValidity()) {
            displayMessage("Preencha o formulário corretamente.");
            return;
        }

        let campoEvento = document.getElementById('inputIdEvento').value;
        let campoUsuario = document.getElementById('inputUsuario').value;

        let cadastro = { 
            id: Date.now().toString(),
            idEvento: campoEvento, 
            idUsuario: campoUsuario
        };

        createCadastro(cadastro, exibeCadastro);
        formCadastro.reset();
        
        // Redefine o ID do evento após reset
        if (eventoId) {
            document.getElementById('inputIdEvento').value = eventoId;
        }
    });

    btnUpdate = document.getElementById("btnUpdate");
    btnUpdate.addEventListener('click', function () {
        let campoId = document.getElementById("inputId").value;
        let campoIdEvento = document.getElementById('inputIdEvento').value;
        let campoUsuario = document.getElementById('inputUsuario').value;

        let cadastro = { 
            id: campoId, 
            idEvento: campoIdEvento, 
            idUsuario: campoUsuario
        };

        updateCadastro(parseInt(campoId), cadastro, exibeCadastro);
        formCadastro.reset();
    });

    btnDelete = document.getElementById('btnDelete');
    btnDelete.addEventListener('click', function () {
        let campoId = document.getElementById('inputId').value;
        if (campoId == "") {
            displayMessage("Selecione um cadastro a ser excluído.");
            return;
        }

        deleteCadastro(parseInt(campoId), exibeCadastro);
        formCadastro.reset();
    });

    btnClear = document.getElementById('btnClear');
    btnClear.addEventListener('click', function () {                
        formCadastro.reset();
        // Redefine o ID do evento após limpar
        if (eventoId) {
            document.getElementById('inputIdEvento').value = eventoId;
        }
    });

    // Preenche formulário ao clicar na tabela
    gridCadastro = document.getElementById("grid-cadastro");
    gridCadastro.addEventListener('click', function (e) {
        if (e.target.tagName == "TD") { 
            let linhaContato = e.target.parentNode;
            colunas = linhaContato.querySelectorAll("td");

            document.getElementById('inputId').value = colunas[0].innerText;
            document.getElementById('inputIdEvento').value = colunas[1].innerText;
            document.getElementById('inputUsuario').value = colunas[2].innerText;
        }
    });

    exibeCadastro();
}

// Chama init quando a página carregar
document.addEventListener('DOMContentLoaded', init);
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous">
    </script>
    
</body>

</html>